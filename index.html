<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="refresh" content="1800">
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Painel de Entregas – Indicador</title>

  <style>
    :root{
      --bg:#0b1020;
      --muted:#9aa4c0;
      --text:#e9ecf5;

      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;

      --shadow: 0 14px 30px rgba(0,0,0,.25);
      --radius:18px;

      --ink:#0b1b3a;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 30% 0%, rgba(11,134,255,.22), transparent 55%),
                  radial-gradient(900px 700px at 80% 20%, rgba(34,197,94,.12), transparent 60%),
                  var(--bg);
      color:var(--text);
    }

    .wrap{ max-width: min(1800px, 96vw); margin: 28px auto 60px; padding: 0 18px; }

    header{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:16px; margin-bottom:18px; flex-wrap:wrap;
    }
    h1{ margin:0; font-size:38px; }

    .rightHead{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }

    .updated{
      color:var(--muted);
      font-size:13px;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:999px;
      background: rgba(255,255,255,.04);
    }

    .filter{
      display:flex; align-items:center; gap:8px;
      padding:8px 10px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:999px;
      background: rgba(255,255,255,.04);
    }
    .filter label{ font-size:12px; color: rgba(233,236,245,.80); }
    select{
      background: rgba(0,0,0,.25);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px;
    }

    /* KPIs */
    .kpis{
      display:grid;
      grid-template-columns: repeat(6, minmax(0,1fr));
      gap:14px;
      margin-top:12px;
    }
    .kpi{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      padding: 16px;
      min-height: 96px;
    }
    .kpi .title{ font-size:13px; color: rgba(233,236,245,.85); }
    .kpi .value{
      font-size: clamp(18px, 2vw, 28px);
      font-weight: 800;
      margin-top: 6px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .kpi .sub{ font-size:12px; color:var(--muted); }

    /* HERO (PERFORMANCE) – ALTURA REDUZIDA */
    .hero{
      margin-top:16px;
      border-radius: var(--radius);
      background: rgba(255,255,255,.92);
      color: var(--ink);
      padding:14px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
      min-height:175px;
    }

    .hero h2{ margin:0 0 6px; font-size:18px; }
    .hero p{ margin:0; font-size:13px; }

    .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.15);
      background:#fff;
    }

    .pill{
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
    }
    .pill.good{ background: var(--good); color:#0b1020; }
    .pill.bad{ background: var(--bad); color:#fff; }

    /* GAUGE REDUZIDO */
    .gauge{
      width:160px;
      height:160px;
      border-radius:50%;
      background: conic-gradient(from 180deg, var(--good) 0deg 120deg, #ddd 120deg);
      position:relative;
    }

    .gauge::after{
      content:"";
      position:absolute;
      inset:14px;
      background:#fff;
      border-radius:50%;
    }

    .gaugeCenter{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:2;
    }

    .gaugeCenter .pct{
      font-size:40px;
      font-weight:900;
    }

    /* PAINÉIS */
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      margin-top:14px;
    }

    .panel{
      background: rgba(255,255,255,.06);
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }

    .ph{
      padding:12px;
      font-weight:800;
      background: rgba(0,0,0,.15);
      display:flex;
      justify-content:space-between;
    }

    table{ width:100%; border-collapse:collapse; }
    th, td{
      padding:8px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      font-size:13px;
    }

    thead th{
      position: sticky;
      top: 0;
      background: rgba(12,18,38,.96);
      font-size:11px;
      text-transform:uppercase;
    }

    .scroll{
      max-height:420px;
      overflow:auto;
    }

    /* RESPONSIVO */
    @media (max-width: 1200px){
      .kpis{ grid-template-columns: repeat(3,1fr); }
    }
    @media (max-width: 900px){
      .kpis{ grid-template-columns: repeat(2,1fr); }
      .hero{ grid-template-columns:1fr; }
      .grid2{ grid-template-columns:1fr; }
    }
  </style>
</head>

<body>
<div class="wrap">

<header>
  <h1>Painel de Entregas</h1>
  <div class="rightHead">
    <div class="filter">
      <label>Transportador</label>
      <select id="carrierFilter">
        <option value="__ALL__">Todos</option>
      </select>
    </div>
    <div class="updated" id="updatedAt">Atualizado em: —</div>
  </div>
</header>

<section class="kpis">
  <div class="kpi"><div class="title">Total de Notas</div><div class="value" id="kpiTotalNotas">—</div></div>
  <div class="kpi"><div class="title">Entregas Realizadas</div><div class="value" id="kpiEntregas">—</div></div>
  <div class="kpi"><div class="title">Notas em Atraso</div><div class="value" id="kpiAtraso">—</div></div>
  <div class="kpi"><div class="title">Previstas Hoje</div><div class="value" id="kpiHoje">—</div></div>
  <div class="kpi"><div class="title">Valor em Atraso</div><div class="value" id="kpiValorAtraso">—</div></div>
  <div class="kpi"><div class="title">Valor Previsto Hoje</div><div class="value" id="kpiValorHoje">—</div></div>
</section>

<section class="hero">
  <div>
    <h2>Performance de Entregas Atual</h2>
    <p>Meta operacional: 95%</p>
    <div style="margin-top:8px; display:flex; gap:8px;">
      <span class="badge" id="metaBadge">Meta: 95%</span>
      <span class="pill" id="metaStatus">—</span>
    </div>
  </div>
  <div style="display:flex; justify-content:center;">
    <div class="gauge">
      <div class="gaugeCenter">
        <div class="pct" id="perfPct">—%</div>
        <div style="font-size:12px;">Eficiência</div>
      </div>
    </div>
  </div>
</section>

<section class="grid2">
  <div class="panel">
    <div class="ph">Notas em Atraso <span id="atrasoCount">—</span></div>
    <div class="scroll" id="scrollAtraso">
      <table>
        <thead>
          <tr>
            <th>NF</th><th>Destinatário</th><th>Transportador</th><th>Prev.</th><th>Ocorrência</th>
          </tr>
        </thead>
        <tbody id="tbodyAtraso"></tbody>
      </table>
    </div>
  </div>

  <div class="panel">
    <div class="ph">Previstas para Hoje <span id="hojeCount">—</span></div>
    <div class="scroll" id="scrollHoje">
      <table>
        <thead>
          <tr>
            <th>NF</th><th>Destinatário</th><th>Transportador</th><th>Cidade</th>
          </tr>
        </thead>
        <tbody id="tbodyHoje"></tbody>
      </table>
    </div>
  </div>
</section>

</div>

<script>
async function load(){
  const r = await fetch('data.json',{cache:'no-store'});
  const d = await r.json();

  updatedAt.textContent = 'Atualizado em: ' + d.updated_at;

  kpiTotalNotas.textContent = d.kpis.total_notas;
  kpiEntregas.textContent = d.kpis.entregas_realizadas;
  kpiAtraso.textContent = d.kpis.notas_em_atraso;
  kpiHoje.textContent = d.kpis.previstas_para_hoje;
  kpiValorAtraso.textContent = 'R$ ' + d.kpis.valor_total_em_atraso.toLocaleString('pt-BR');
  kpiValorHoje.textContent = 'R$ ' + d.kpis.valor_total_previsto_hoje.toLocaleString('pt-BR');

  perfPct.textContent = d.kpis.performance_percent.toFixed(2) + '%';

  metaStatus.textContent =
    d.kpis.performance_percent >= d.kpis.meta_performance_percent
    ? 'OK'
    : 'Atenção';

  metaStatus.className =
    d.kpis.performance_percent >= d.kpis.meta_performance_percent
    ? 'pill good'
    : 'pill bad';
}
load();
</script>

</body>
</html>
