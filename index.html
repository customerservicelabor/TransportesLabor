<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="refresh" content="3600">
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Painel de Entregas</title>

  <style>
    :root{
      --bg:#0b1020;
      --text:#e9ecf5;
      --muted:#9aa4c0;

      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;

      --radius:18px;
      --shadow:0 14px 30px rgba(0,0,0,.25);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color:var(--text);
    }

    .wrap{ max-width:1800px; margin:24px auto; padding:0 16px; }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:16px;
      flex-wrap:wrap;
      gap:12px;
    }

    h1{ margin:0; font-size:32px; }

    .updated{
      font-size:12px;
      color:var(--muted);
      padding:8px 12px;
      border:1px solid rgba(255,255,255,.1);
      border-radius:999px;
      background:rgba(255,255,255,.05);
    }

    .kpis{
      display:grid;
      grid-template-columns:repeat(6,1fr);
      gap:12px;
      margin-bottom:14px;
    }

    .kpi{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.1);
      border-radius:var(--radius);
      padding:14px;
    }

    .kpi .title{ font-size:13px; color:var(--muted); }
    .kpi .value{ font-size:26px; font-weight:800; }

    /* HERO PERFORMANCE */
    .hero-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
      margin-bottom:14px;
    }

    .hero{
      background:#fff;
      color:#0b1020;
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      justify-content:center;
    }

    .hero h2{ margin:0 0 6px; }

    .pill{
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      display:inline-block;
      width:max-content;
    }
    .pill.good{ background:var(--good); color:#052e16; }
    .pill.bad{ background:var(--bad); color:#fff; }

    .perf-value{
      font-size:52px;
      font-weight:900;
      text-align:center;
      margin-top:8px;
    }

    /* PAINÉIS */
    .panel{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.1);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow:var(--shadow);
      height:100%;
    }

    .ph{
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,.1);
      font-weight:800;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .scroll{
      max-height:420px;
      overflow:auto;
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }

    th,td{
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      text-align:left;
    }

    thead th{
      position:sticky;
      top:0;
      background:#0b1020;
      z-index:2;
    }

    .row-done{ background:rgba(34,197,94,.18); }
    .row-arrived{ background:rgba(245,158,11,.22); }
    .row-left{ background:rgba(34,197,94,.28); }

    .grid2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
    }

    @media(max-width:1100px){
      .kpis{ grid-template-columns:repeat(3,1fr); }
      .hero-grid{ grid-template-columns:1fr; }
      .grid2{ grid-template-columns:1fr; }
    }
  </style>
</head>

<body>
<div class="wrap">

<header>
  <h1>Painel de Entregas</h1>
  <div class="updated" id="updatedAt">Atualizado em —</div>
</header>

<section class="kpis">
  <div class="kpi"><div class="title">Total de Notas</div><div class="value" id="kTotal">—</div></div>
  <div class="kpi"><div class="title">Entregas Realizadas</div><div class="value" id="kEntregas">—</div></div>
  <div class="kpi"><div class="title">Notas em Atraso</div><div class="value" id="kAtraso">—</div></div>
  <div class="kpi"><div class="title">Previstas Hoje</div><div class="value" id="kHoje">—</div></div>
  <div class="kpi"><div class="title">Valor em Atraso</div><div class="value" id="kValorAtraso">—</div></div>
  <div class="kpi"><div class="title">Valor Previsto Hoje</div><div class="value" id="kValorHoje">—</div></div>
</section>

<section class="hero-grid">
  <!-- PERFORMANCE -->
  <div class="hero">
    <h2>Performance de Entregas</h2>
    <p>Meta operacional: <strong>95%</strong></p>
    <span class="pill bad" id="perfStatus">Abaixo da meta</span>
    <div class="perf-value" id="perfPct">—%</div>
  </div>

  <!-- TRANSPORTADORES -->
  <div class="panel">
    <div class="ph">Transportadores</div>
    <div class="scroll">
      <table>
        <thead>
          <tr>
            <th>Transportador</th>
            <th>Chegada</th>
            <th>Saída</th>
            <th>Próxima Coleta</th>
          </tr>
        </thead>
        <tbody id="tbodyTransp"></tbody>
      </table>
    </div>
  </div>
</section>

<section class="grid2">
  <div class="panel">
    <div class="ph">Notas em Atraso</div>
    <div class="scroll">
      <table>
        <thead>
          <tr>
            <th>NF</th>
            <th>Destinatário</th>
            <th>Transportador</th>
            <th>Prev. Entrega</th>
            <th>Ocorrência</th>
          </tr>
        </thead>
        <tbody id="tbodyAtraso"></tbody>
      </table>
    </div>
  </div>

  <div class="panel">
    <div class="ph">Previstas para Hoje</div>
    <div class="scroll">
      <table>
        <thead>
          <tr>
            <th>NF</th>
            <th>Destinatário</th>
            <th>Transportador</th>
            <th>Cidade</th>
            <th>Entrega</th>
          </tr>
        </thead>
        <tbody id="tbodyHoje"></tbody>
      </table>
    </div>
  </div>
</section>

</div>

<script>
/* AUTO SCROLL SUAVE */
const AUTO_SCROLL={stepPx:1,intervalMs:45,pauseEndMs:1500,pauseTopMs:800};
function startScroll(el){
  let pause=0,hover=false;
  el.addEventListener('mouseenter',()=>hover=true);
  el.addEventListener('mouseleave',()=>hover=false);
  setInterval(()=>{
    if(hover||Date.now()<pause)return;
    const max=el.scrollHeight-el.clientHeight;
    if(max<=0)return;
    if(el.scrollTop>=max-1){
      pause=Date.now()+AUTO_SCROLL.pauseEndMs;
      setTimeout(()=>{el.scrollTop=0;pause=Date.now()+AUTO_SCROLL.pauseTopMs;},AUTO_SCROLL.pauseEndMs);
      return;
    }
    el.scrollTop+=AUTO_SCROLL.stepPx;
  },AUTO_SCROLL.intervalMs);
}

fetch('data.json',{cache:'no-store'}).then(r=>r.json()).then(d=>{
  updatedAt.textContent='Atualizado em: '+d.updated_at;
  kTotal.textContent=d.kpis.total_notas;
  kEntregas.textContent=d.kpis.entregas_realizadas;
  kAtraso.textContent=d.kpis.notas_em_atraso;
  kHoje.textContent=d.kpis.previstas_para_hoje;
  kValorAtraso.textContent='R$ '+d.kpis.valor_total_em_atraso.toLocaleString('pt-BR');
  kValorHoje.textContent='R$ '+d.kpis.valor_total_previsto_hoje.toLocaleString('pt-BR');
  perfPct.textContent=d.kpis.performance_percent.toFixed(2)+'%';

  tbodyTransp.innerHTML='';
  d.transportadores.forEach(t=>{
    let cls='';
    if(t.saida) cls='row-left';
    else if(t.chegada) cls='row-arrived';
    tbodyTransp.innerHTML+=`
      <tr class="${cls}">
        <td>${t.nome}</td>
        <td>${t.chegada||'-'}</td>
        <td>${t.saida||'-'}</td>
        <td>${t.proxima_coleta||'-'}</td>
      </tr>`;
  });

  tbodyAtraso.innerHTML='';
  d.notas_em_atraso.forEach(n=>{
    tbodyAtraso.innerHTML+=`
      <tr>
        <td>${n.nota_fiscal}</td>
        <td>${n.destinatario}</td>
        <td>${n.transportador}</td>
        <td>${n.previsao_entrega}</td>
        <td>${n.ocorrencia||'-'}</td>
      </tr>`;
  });

  tbodyHoje.innerHTML='';
  d.notas_previstas_hoje.forEach(n=>{
    tbodyHoje.innerHTML+=`
      <tr class="${n.data_entrega?'row-done':''}">
        <td>${n.nota_fiscal}</td>
        <td>${n.destinatario}</td>
        <td>${n.transportador}</td>
        <td>${n.cidade_destino}</td>
        <td>${n.data_entrega||'-'}</td>
      </tr>`;
  });

  document.querySelectorAll('.scroll').forEach(startScroll);
});
</script>
</body>
</html>
